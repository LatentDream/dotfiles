[alias]
    # List all git aliases with colored formatting
    aliases = "!git config --get-regexp alias | sed 's/^alias\\.//' | awk '{name=$1; cmd=substr($0, length(name)+2); printf \"%s%-12s%s = %s\\n\", \"\\033[1;34m\", name, \"\\033[0m\", cmd}' | sort"

    # Renormalize line endings (requires clean working directory)
    renormalize = "!f() { if [ -n \"$(git status --porcelain)\" ]; then echo 'ERROR: Working directory not clean.'; exit 1; fi; git add --renormalize . && git reset && git add .; }; f"

    # Remove files from staging area
    unstage = reset HEAD --

    # Show the last commit
    last = log -1 HEAD

    # Worktree shortcut
    wt = worktree
    
    # List all worktrees
    wtl = worktree list
    
    # Show worktree list with status for each worktree
    wts = "!f() { echo ""; git worktree list | while read -r line; do dir=${line%*  *}; echo "$(tput setaf 4)${line%* [*}$(tput sgr 0)"; unset GIT_DIR; git -C $dir status -sb; echo ""; done; }; f"
    
    # Add a detached worktree (without recursing into submodules)
    wta = -c "submodule.recurse=" worktree add --detach
    
    # Create a worktree on master with branch name z/<repo-name>
    wtz = !dir=$(git root) && git co origin/master -B "z/$(basename "$dir")" --no-track

    # Terminal-width-aware log with dynamic column sizing (capped at 120 chars)
    lx = "!f() { \
        COLUMNS=$(tput cols); \
        END=$((COLUMNS - 160)); \
        END=$((END < 0 ? 0 : END)); \
        COLUMNS=$((COLUMNS - END)); \
        git log --pretty=tformat:\"%Creset%<|($((COLUMNS-46)),trunc)%s%C(bold cyan)  %<(12,trunc)%al  %Cblue%<(14,trunc)%cr  %C(bold black)%<($((END+12)))%h  %C(auto)%d\" \"$@\"; \
    }; f"
    
    # Log with graph and detailed stats
    ll = log --graph --stat='100,0,20' --stat-graph-width=20 --pretty=longlog
    
    # Reflog with custom pretty format
    rl = reflog --pretty=reflog
    
    # List tags with formatted columns (name, hash, author, date, message)
    tagl = tag --format='%(color:cyan)%(align:25)%(refname:short)%(end) %(if)%(object)%(then)%(object)%(else)%(objectname)%(end) %(color:green)%(align:10)%(taggeremail:localpart)%(end) %(color:white)%(align:40,40)[%(creatordate:relative)] %(contents:lines=1)%(end)' -l
    
    # Show detailed tag information (distinguishes between annotated and lightweight tags)
    tagv = tag --format='%(color:bold cyan)== %(refname:short) ==%(if)%(object)%(then)%0aTag Hash: %(objectname)%0aTag Date: %(taggerdate:iso-local)%0a  Commit: %(object) %0a%0a%(contents)%(else)%0a(lightweight tag)%0a  Commit: %(objectname)%(end)%0a' -l

    # Generate a plain diff suitable for patch files (no pager, no color)
    patch = !git --no-pager diff --no-color
    
    # Show the root directory of the repository
    root = rev-parse --show-toplevel

    # Quick way to discard all changes (stages everything, commits, then hard resets)
    trash = !git add -A && git commit -m 'TRASH' && git reset --hard HEAD^
    
    # Squash all commits into a single initial commit
    squash-all = ! "git reset $(git commit-tree HEAD^{tree} -m 'Initial commit')"

    # Open a zsh shell in git environment (useful for testing)
    zsh = !zsh
    
    # Open a bash shell in git environment (useful for testing)
    bash = !bash
    
    # Open a sh shell in git environment (useful for testing)
    sh = !sh

    # Delta-formatted versions
    ddiff = -c diff.external= diff
    dshow = -c diff.external= show
    dlog = -c diff.external= log -p
    dstaged = -c diff.external= diff --staged

    # Status with custom options (short, branch, stash info, include submodules)
    status- = !git -c color.status=always status --short --branch --show-stash --ignore-submodules=none

    # Branch list with verbose output (shows upstream tracking)
    b  = branch -vv
    
    # Commit shortcut
    c  = commit
    
    # Diff shortcut
    d  = diff
    
    # Help shortcut
    h  = help

    # Checkout with progress indicator
    co = checkout --progress

    # Enhanced status that shows main repo and all submodules with indentation
    s = "!f(){ \
            top=$(git rev-parse --show-toplevel 2>/dev/null); \
            if [ -s \"$top/.gitmodules\" ]; then \
                printf '\\033[1;35m[.]\\033[0m\\n'; \
                git status- | sed 's/^/  /'; \
                echo; \
                git submodule foreach --quiet --recursive \"printf '\\033[1;35m[%s]\\033[0m\\n' \\\"\\$path\\\"; git status- | sed 's/^/  /'\"; \
            else \
                git status- ; \
            fi; \
        }; f"

[column]
    ui = auto

[branch]
    sort = -committerdate

[tag]
    sort = version:refname

[init]
    defaultBranch = main

[push]
    default = simple
    autoSetupRemote = true
    followTags = true

[fetch]
    prune = true
    pruneTags = true
    all = true

[help]
    autocorrect = prompt

[commit]
    verbose = true

[rerere]
    enabled = true
    autoupdate = true

[rebase]
    autoSquash = true
    autoStash = true
    updateRefs = true

[merge]
    conflictstyle = zdiff3 

[pull]
    rebase = true

[core]
    pager = delta
    # turn on filesystem watcher to avoid rescanning tree for status
    fsmonitor = true
    untrackedCache = true
    excludesfile = ~/.gitignore
    editor = nvim
    eol = lf
    hideDotFiles = false
    # auto conversion between eol's sucks. standardize everywhere on lf always.
    ; autocrlf = input
    ; core.eol = lf
    # set windows to "developer mode" to support symlinks without elevation
    ; core.symlinks = true

[feature]
    # optimizations to speed certain operations in monorepos
    manyFiles = true

[blame]
    # commits to skip on blame (look in the file for docs)
    ignoreRevsFile = .git-blame-ignore-revs

[interactive]
    diffFilter = delta --color-only

[delta]
    navigate = true
    features = decorations

[diff]
    colorMoved = default
    algorithm = histogram
    mnemonicprefix = true
    renames = copies
    renameLimit = 50000
    external = difft

[difftool "difftastic"]
    cmd = difft "$LOCAL" "$REMOTE"

[pretty]
    longlog = ___%n   \\%n%C(auto)%d%Creset %s%n%C(bold cyan)% ae %Cblue(%cr) %C(bold black)%h
    reflog = %C(auto)%h %gd %C(blue)%cr%C(reset)%n          %C(italic)%gs%n          %C(bold magenta)%s
    shortlog-graph = %<|(15)%Creset%<|(-36,trunc)%s%C(bold cyan)  %<(10,trunc)%al  %Cblue%<(11,trunc)%cr  %C(bold black)%h  %C(auto)%d

; [diff “lfs-text”]
;   textconv = cat
;
; [merge “lfs-text”]
;   driver = 'git lfs merge-driver --ancestor %O --current %A --other %B --marker-size %L --output %A'
;
; [lfs]
;   # can greatly speed up checkouts where files are in LFS and not cached
;   concurrenttransfers = 24

[include]
    path = ~/.gitconfig.local

[user]
    # https://orrsella.com/2013/08/10/git-using-different-user-emails-for-different-repositories/
    # Require setting user.name and email per-repo:
    #   $ git config --global user.useConfigOnly true
    #   # Remove email address from global config:
    #   $ git config --global --unset-all user.email
	useConfigOnly = true
